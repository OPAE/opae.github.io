

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quick Start Guide &mdash; OPAE</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="OPAE Installation Guide" href="../../install_guide/installation_guide.html" />
    <link rel="prev" title="Open Programmable Acceleration Engine" href="../../../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> OPAE
          

          
          </a>

          
            
            
              <div class="version">
                2.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">OPAE User Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-the-opae-linux-device-drivers-from-source">Build the OPAE Linux device drivers from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-and-installing-the-opae-sdk-from-source">Building and installing the OPAE SDK from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-fpga-loading-an-fpga-afu">Configuring the FPGA (loading an FPGA AFU)##</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-sample-application">Building a sample application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-iofs-release1-bitstream-on-fpga-pcie-card">Setup IOFS Release1 Bitstream on FPGA PCIe card</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../install_guide/installation_guide.html">OPAE Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/readme.html">OPAE C API Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyopae/README.html">OPAE Python Bindings</a></li>
</ul>
<p class="caption"><span class="caption-text">OPAE Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../build_chain/fpga_api/api_build.html">Building OPAE SDK Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga_api.html">OPAE C API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga_cxx_api.html">OPAE C++ Core API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga_python_api.html">OPAE Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plug_guide/readme.html">Plugin Developer’s Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">OPAE Linux Kernel Drivers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../drv_arch/drv_arch.html">Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture</a></li>
</ul>
<p class="caption"><span class="caption-text">OPAE FPGA Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/fpgaconf/fpgaconf.html">fpgaconf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/fpgad/fpgad.html">fpgad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/fpgadiag/README.html">fpgadiag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/fpgainfo/fpgainfo.html">fpgainfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/fpgasupdate/fpgasupdate.html">fpgasupdate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/mmlink/mmlink.html">mmlink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/packager/packager.html">packager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/userclk/userclk.html">userclk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/hssi/hssi.html">hssi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/opaevfio/opaevfio.html">opaevfio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/pci_device/pci_device.html">pci_device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/opae.io/opae.io.html">opae.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/host_exerciser/host_exerciser.html">host_exerciser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/hssi_ethernet/hssistats.html">HSSI ethernet statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/hssi_ethernet/hssimac.html">HSSI ethernet mac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/hssi_ethernet/hssiloopback.html">HSSI ethernet loopback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga_tools/rsu/rsu.html">rsu</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OPAE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Quick Start Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/docs/fpga_api/quick_start/readme.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quick-start-guide">
<h1>Quick Start Guide<a class="headerlink" href="#quick-start-guide" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The OPAE C library is a lightweight user-space library that provides
abstraction for FPGA resources in a compute environment. Built on top of the
OPAE Intel® FPGA driver stack that supports Intel® FPGA platforms, the library
abstracts away hardware specific and OS specific details and exposes the
underlying FPGA resources as a set of features accessible from within
software programs running on the host.</p>
<p>These features include the acceleration logic preconfigured on the
device, as well as functions to manage and reconfigure the
device. Hence, the library is able to enable user applications to
transparently and seamlessly leverage FPGA-based acceleration.</p>
<p>In this document, we will explore the initial steps on how to setup
the required libraries and utilities to use the FPGA devices.</p>
<p>If you do not have access to an Intel® Xeon® processor with integrated
FPGA, or a programmable FPGA acceleration card for Intel® Xeon®
processors, you will not be able to run the examples below. However, you can
still make use of the AFU simulation environment (ASE) to develop and test
accelerator RTL with OPAE applications.</p>
<p>The source for the OPAE SDK Linux device drivers is available at the
<a class="reference external" href="https://github.com/OPAE/linux-dfl">OPAE Linux DFL drivers repository</a>.</p>
<p>``</p>
</div>
<div class="section" id="build-the-opae-linux-device-drivers-from-source">
<h2>Build the OPAE Linux device drivers from source<a class="headerlink" href="#build-the-opae-linux-device-drivers-from-source" title="Permalink to this headline">¶</a></h2>
<p>For building the OPAE kernel and kernel driver, the kernel development environment is required. So before you build the kernel, you must install the required packages. Run the following commands:</p>
<p>We using Federa 32 as an example.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo yum install gcc gcc-c++ make kernel-headers kernel-devel elfutils-libelf-devel ncurses-devel openssl-devel bison flex
</pre></div>
</div>
<p>Download the OPAE upstream kernel tree from github.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone https://github.com/OPAE/linux-dfl.git -b fpga-upstream-dev-5.8.0
</pre></div>
</div>
<p>Configure the kernel.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> linux-dfl
<span class="gp">$ </span>cp /boot/config-<span class="sb">`</span>uname -r<span class="sb">`</span> .config
<span class="gp">$ </span>cat configs/n3000_d5005_defconfig &gt;&gt; .config 
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">&#39;CONFIG_LOCALVERSION=&quot;-dfl&quot;&#39;</span> &gt;&gt; .config
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">&#39;CONFIG_LOCALVERSION_AUTO=y&#39;</span> &gt;&gt; .config
<span class="gp">$ </span>make olddefconfig
</pre></div>
</div>
<p>Compile and install the new kernel.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>make -j
<span class="gp">$ </span>sudo make modules_install
<span class="gp">$ </span>sudo make install
</pre></div>
</div>
<p>When installed finished, reboot your system.
When the system login again, check the kernel version is correctly or not.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[figo@localhost linux-dfl]$ </span>uname -a
<span class="go">Linux localhost.localdomain 5.8.0-rc1-dfl-g73e16386cda0 #6 SMP Wed Aug 19 08:38:32 EDT 2020 x86_64 x86_64 x86_64 GNU/Linux</span>
</pre></div>
</div>
</div>
<div class="section" id="building-and-installing-the-opae-sdk-from-source">
<h2>Building and installing the OPAE SDK from source<a class="headerlink" href="#building-and-installing-the-opae-sdk-from-source" title="Permalink to this headline">¶</a></h2>
<p>Download the OPAE SDK source package from the respective <a class="reference external" href="https://github.com/OPAE/opae-sdk/releases">release page on
GitHub</a> - click the <code class="docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span> <span class="pre">(tar.gz)</span></code> link under “Downloads”.</p>
<p>After downloading the source, unpack, configure, and compile it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">    tar xfvz opae-sdk-&lt;release&gt;.tar.gz</span>
<span class="go">    cd opae-sdk-&lt;release&gt;</span>
<span class="go">    mkdir build</span>
<span class="go">    cd build</span>
<span class="go">    cmake ..</span>
<span class="go">    make</span>
</pre></div>
</div>
<p>By default, the OPAE SDK will install into <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> if you also issue the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">    sudo make install</span>
</pre></div>
</div>
<p>You can change this installation prefix from <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> into something else
by adding <code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX=&lt;new</span> <span class="pre">prefix&gt;</span></code> to the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command above.
The remainder of this guide assumes you installed into <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>.</p>
</div>
<div class="section" id="configuring-the-fpga-loading-an-fpga-afu">
<h2>Configuring the FPGA (loading an FPGA AFU)##<a class="headerlink" href="#configuring-the-fpga-loading-an-fpga-afu" title="Permalink to this headline">¶</a></h2>
<p>The <em>fpgaconf</em> tool exercises the AFU reconfiguration
functionality. It shows how to read a bitstream from a disk file,
check its validity and compatability, and then injects it into FPGA to
be configured as a new AFU, which can then be discovered and used by
user applications.</p>
<p>For this step you require a valid green bitstream (GBS) file. To
reconfigure the FPGA slot, you can issue following command as system
administrator (<em>root</em>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo fpgaconf -b 0x5e &lt;filename&gt;.gbs
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-b</span></code> parameter to <em>fpgaconf</em> indicates the <em>target bus number</em> of the
FPGA slot to be reconfigured. Alternatively, you can also specify the
<em>target socket number</em> of the FPGA using the <code class="docutils literal notranslate"><span class="pre">-s</span></code> parameter.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo fpgaconf --help
<span class="go">Usage:</span>
<span class="go">        fpgaconf [-hvn] [-b &lt;bus&gt;] [-d &lt;device&gt;] [-f &lt;function&gt;] [-s &lt;socket&gt;] &lt;gbs&gt;</span>

<span class="go">                -h,--help           Print this help</span>
<span class="go">                -v,--verbose        Increase verbosity</span>
<span class="go">                -n,--dry-run        Don&#39;t actually perform actions</span>
<span class="go">                -b,--bus            Set target bus number</span>
<span class="go">                -d,--device         Set target device number</span>
<span class="go">                -f,--function       Set target function number</span>
<span class="go">                -s,--socket         Set target socket number</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sample application on the Building a Sample Application
section requires loading of an AFU called “Native Loopback
Adapter” (NLB) on the FPGA. Please refer to the NLB documentation
for the location of the NLB’s green bitstream. You also can verify
if the NLB green bitstream has already been loaded into the FPGA
slot by typing the following command and checking the output
matches the following:</p>
<p>$ cat /sys/class/fpga_region/region0/dfl-port.0/afu_id</p>
<p>d8424dc4a4a3c413f89e433683f9040b</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fpgaconf tool is not available for the Intel PAC N3000. The NLB is
alrealy include in AFU.</p>
</div>
</div>
<div class="section" id="building-a-sample-application">
<h2>Building a sample application<a class="headerlink" href="#building-a-sample-application" title="Permalink to this headline">¶</a></h2>
<p>The library source includes code samples. Use these samples to learn
how to call functions in the library. Build and run these samples as
quick sanity checks to determine if your installation and environment
are set up properly.</p>
<p>In this guide, we will build <em>hello_fpga.c</em>. This is the “Hello
World!” example of using the library.  This code searches for a
predefined and known AFU called “Native Loopback Adapter” on the
FPGA. If found, it acquires ownership and then interacts with the AFU
by sending it a 2MB message and waiting for the message being echoed
back. This code exercises all major components of the API except for
AFU reconfiguration: AFU search, enumeration, access, MMIO, and memory
management.</p>
<p>You can also find the source for <code class="docutils literal notranslate"><span class="pre">hello\_fpga</span></code> in the <code class="docutils literal notranslate"><span class="pre">samples</span></code> directory of the
OPAE SDK repository on github.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>    <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
    <span class="p">{</span>
        <span class="n">fpga_properties</span>    <span class="n">filter</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">fpga_token</span>         <span class="n">afu_token</span><span class="p">;</span>
        <span class="n">fpga_handle</span>        <span class="n">afu_handle</span><span class="p">;</span>
        <span class="n">fpga_guid</span>          <span class="n">guid</span><span class="p">;</span>
        <span class="kt">uint32_t</span>           <span class="n">num_matches</span><span class="p">;</span>

        <span class="k">volatile</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">dsm_ptr</span>    <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">volatile</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">status_ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">volatile</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">input_ptr</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">volatile</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">output_ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

        <span class="kt">uint64_t</span>        <span class="n">dsm_wsid</span><span class="p">;</span>
        <span class="kt">uint64_t</span>        <span class="n">input_wsid</span><span class="p">;</span>
        <span class="kt">uint64_t</span>        <span class="n">output_wsid</span><span class="p">;</span>
        <span class="n">fpga_result</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">FPGA_OK</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">uuid_parse</span><span class="p">(</span><span class="n">NLB0_AFUID</span><span class="p">,</span> <span class="n">guid</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Error parsing guid &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">NLB0_AFUID</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">out_exit</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/* Look for accelerator by its &quot;afu_id&quot; */</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaGetProperties</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_exit</span><span class="p">,</span> <span class="s">&quot;creating properties object&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaPropertiesSetObjectType</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">FPGA_ACCELERATOR</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_destroy_prop</span><span class="p">,</span> <span class="s">&quot;setting object type&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaPropertiesSetGuid</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">guid</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_destroy_prop</span><span class="p">,</span> <span class="s">&quot;setting GUID&quot;</span><span class="p">);</span>

        <span class="cm">/* TODO: Add selection via BDF / device ID */</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaEnumerate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">afu_token</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_destroy_prop</span><span class="p">,</span> <span class="s">&quot;enumerating accelerators&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num_matches</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;accelerator not found.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaDestroyProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FPGA_INVALID_PARAM</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/* Open accelerator and map MMIO */</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaOpen</span><span class="p">(</span><span class="n">afu_token</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_destroy_tok</span><span class="p">,</span> <span class="s">&quot;opening accelerator&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaMapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_close</span><span class="p">,</span> <span class="s">&quot;mapping MMIO space&quot;</span><span class="p">);</span>

        <span class="cm">/* Allocate buffers */</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">LPBK1_DSM_SIZE</span><span class="p">,</span>
                    <span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dsm_ptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dsm_wsid</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_close</span><span class="p">,</span> <span class="s">&quot;allocating DSM buffer&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">LPBK1_BUFFER_ALLOCATION_SIZE</span><span class="p">,</span>
                   <span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">input_ptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input_wsid</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_dsm</span><span class="p">,</span> <span class="s">&quot;allocating input buffer&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">LPBK1_BUFFER_ALLOCATION_SIZE</span><span class="p">,</span>
                   <span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">output_ptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">output_wsid</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_input</span><span class="p">,</span> <span class="s">&quot;allocating output buffer&quot;</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Running Test</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

        <span class="cm">/* Initialize buffers */</span>
        <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">dsm_ptr</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="n">LPBK1_DSM_SIZE</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">input_ptr</span><span class="p">,</span>  <span class="mh">0xAF</span><span class="p">,</span> <span class="n">LPBK1_BUFFER_SIZE</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">output_ptr</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">,</span> <span class="n">LPBK1_BUFFER_SIZE</span><span class="p">);</span>

        <span class="n">cache_line</span> <span class="o">*</span><span class="n">cl_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">cache_line</span> <span class="o">*</span><span class="p">)</span><span class="n">input_ptr</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LPBK1_BUFFER_SIZE</span> <span class="o">/</span> <span class="n">CL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cl_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">uint</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* set the last uint in every cacheline */</span>
        <span class="p">}</span>

        <span class="cm">/* Reset accelerator */</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaReset</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;resetting accelerator&quot;</span><span class="p">);</span>

        <span class="cm">/* Program DMA addresses */</span>
        <span class="kt">uint64_t</span> <span class="n">iova</span><span class="p">;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">dsm_wsid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;getting DSM IOVA&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_AFU_DSM_BASEL</span><span class="p">,</span> <span class="n">iova</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_AFU_DSM_BASEL&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_CTL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_CTL</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">input_wsid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;getting input IOVA&quot;</span><span class="p">);</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_SRC_ADDR</span><span class="p">,</span> <span class="n">CACHELINE_ALIGNED_ADDR</span><span class="p">(</span><span class="n">iova</span><span class="p">));</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_SRC_ADDR&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">output_wsid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;getting output IOVA&quot;</span><span class="p">);</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_DST_ADDR</span><span class="p">,</span> <span class="n">CACHELINE_ALIGNED_ADDR</span><span class="p">(</span><span class="n">iova</span><span class="p">));</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_DST_ADDR&quot;</span><span class="p">);</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_NUM_LINES</span><span class="p">,</span> <span class="n">LPBK1_BUFFER_SIZE</span> <span class="o">/</span> <span class="n">CL</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_NUM_LINES&quot;</span><span class="p">);</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_CFG</span><span class="p">,</span> <span class="mh">0x42000</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>

        <span class="n">status_ptr</span> <span class="o">=</span> <span class="n">dsm_ptr</span> <span class="o">+</span> <span class="n">DSM_STATUS_TEST_COMPLETE</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>

        <span class="cm">/* Start the test */</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_CTL</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>

        <span class="cm">/* Wait for test completion */</span>
        <span class="k">while</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">((</span><span class="o">*</span><span class="n">status_ptr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* Stop the device */</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CSR_CTL</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_output</span><span class="p">,</span> <span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>

        <span class="cm">/* Check output buffer contents */</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LPBK1_BUFFER_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">output_ptr</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">input_ptr</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Output does NOT match input &quot;</span>
                    <span class="s">&quot;at offset %i!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Done Running Test</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

        <span class="cm">/* Release buffers */</span>
    <span class="nl">out_free_output</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">output_wsid</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_input</span><span class="p">,</span> <span class="s">&quot;releasing output buffer&quot;</span><span class="p">);</span>
    <span class="nl">out_free_input</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">input_wsid</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_free_dsm</span><span class="p">,</span> <span class="s">&quot;releasing input buffer&quot;</span><span class="p">);</span>
    <span class="nl">out_free_dsm</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="n">dsm_wsid</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_unmap</span><span class="p">,</span> <span class="s">&quot;releasing DSM buffer&quot;</span><span class="p">);</span>

        <span class="cm">/* Unmap MMIO space */</span>
    <span class="nl">out_unmap</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaUnmapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_close</span><span class="p">,</span> <span class="s">&quot;unmapping MMIO space&quot;</span><span class="p">);</span>

        <span class="cm">/* Release accelerator */</span>
    <span class="nl">out_close</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaClose</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_destroy_tok</span><span class="p">,</span> <span class="s">&quot;closing accelerator&quot;</span><span class="p">);</span>

        <span class="cm">/* Destroy token */</span>
    <span class="nl">out_destroy_tok</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaDestroyToken</span><span class="p">(</span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_destroy_prop</span><span class="p">,</span> <span class="s">&quot;destroying token&quot;</span><span class="p">);</span>

        <span class="cm">/* Destroy properties object */</span>
    <span class="nl">out_destroy_prop</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fpgaDestroyProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
        <span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">out_exit</span><span class="p">,</span> <span class="s">&quot;destroying properties object&quot;</span><span class="p">);</span>

    <span class="nl">out_exit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>

    <span class="p">}</span>
</pre></div>
</div>
<p>Linking with the OPAE library is straightforward.  Code using this library
should include the header file <code class="docutils literal notranslate"><span class="pre">fpga.h</span></code>. Taking the GCC compiler on
Linux as an example, the minimalist compile and link line should look
like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gcc -std<span class="o">=</span>c99 hello_fpga.c -I/usr/local/include -L/usr/local/lib -lopae-c -luuid -ljson-c -lpthread -o hello_fpga
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Third-party library dependency: The library internally uses
<cite>libuuid</cite> and <cite>libjson-c</cite>. But they are not distributed as part of the
library. Make sure you have these libraries properly installed.</p>
</div>
<dl class="simple">
<dt>$ sudo ./hello_fpga -c</dt><dd><p>Running Test
Running on bus 0x08.
AFU NLB0 found &#64; 28000
Done Running Test</p>
</dd>
</dl>
<p>To run the <em>hello_fpga</em> application; just issue:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo ./hello_fpga

<span class="go">Running Test</span>
<span class="go">Done</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-iofs-release1-bitstream-on-fpga-pcie-card">
<h2>Setup IOFS Release1 Bitstream on FPGA PCIe card<a class="headerlink" href="#setup-iofs-release1-bitstream-on-fpga-pcie-card" title="Permalink to this headline">¶</a></h2>
<p>Program IOFS Release1 bitstream on FPGA D5005 or N6000 cards and reboot system.</p>
<p>Run command: lspci | grep acc</p>
<p><code class="docutils literal notranslate"><span class="pre">3b:00.0</span> <span class="pre">Processing</span> <span class="pre">accelerators:</span> <span class="pre">Intel</span> <span class="pre">Corporation</span> <span class="pre">Device</span> <span class="pre">af00</span> <span class="pre">(rev</span> <span class="pre">01)</span></code></p>
<p>Number of virtual functions supported by bitstream</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>   <span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">pci</span><span class="o">/</span><span class="n">devices</span><span class="o">/</span><span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.0</span><span class="o">/</span><span class="n">sriov_totalvfs</span> 
   <span class="nl">output</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Enable FPGA virtual functions</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>   <span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s">&quot;echo 3 &gt; /sys/bus/pci/devices/0000:3b:00.0/sriov_numvfs&quot;</span>
</pre></div>
</div>
<p>List of FPGA PF and VF’s</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Physical</span> <span class="n">Functions</span> <span class="p">(</span><span class="n">PFs</span><span class="p">)</span><span class="o">:</span>
  <span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">Processing</span> <span class="nl">accelerators</span><span class="p">:</span> <span class="n">Intel</span> <span class="n">Corporation</span> <span class="n">Device</span> <span class="n">af00</span> <span class="p">(</span><span class="n">rev</span> <span class="mo">01</span><span class="p">)</span>

<span class="n">Virtual</span> <span class="n">Functions</span> <span class="p">(</span><span class="n">VFs</span><span class="p">).</span>
  <span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.1</span> <span class="n">Processing</span> <span class="nl">accelerators</span><span class="p">:</span> <span class="n">Intel</span> <span class="n">Corporation</span> <span class="n">Device</span> <span class="n">af01</span> <span class="p">(</span><span class="n">rev</span> <span class="mo">01</span><span class="p">)</span>
  <span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.2</span> <span class="n">Processing</span> <span class="nl">accelerators</span><span class="p">:</span> <span class="n">Intel</span> <span class="n">Corporation</span> <span class="n">Device</span> <span class="n">af01</span> <span class="p">(</span><span class="n">rev</span> <span class="mo">01</span><span class="p">)</span>
  <span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.3</span> <span class="n">Processing</span> <span class="nl">accelerators</span><span class="p">:</span> <span class="n">Intel</span> <span class="n">Corporation</span> <span class="n">Device</span> <span class="n">af01</span> <span class="p">(</span><span class="n">rev</span> <span class="mo">01</span><span class="p">)</span>
</pre></div>
</div>
<p>Bind vfio-pcie driver to FPGA virtual functions</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>   <span class="n">sudo</span> <span class="n">opaevfio</span>  <span class="o">-</span><span class="n">i</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.1</span> <span class="o">-</span><span class="n">u</span> <span class="n">userid</span> <span class="o">-</span><span class="n">g</span> <span class="n">groupid</span>
   <span class="n">sudo</span> <span class="n">opaevfio</span>  <span class="o">-</span><span class="n">i</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.2</span> <span class="o">-</span><span class="n">u</span> <span class="n">userid</span> <span class="o">-</span><span class="n">g</span> <span class="n">groupid</span>
   <span class="n">sudo</span> <span class="n">opaevfio</span>  <span class="o">-</span><span class="n">i</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.3</span> <span class="o">-</span><span class="n">u</span> <span class="n">userid</span> <span class="o">-</span><span class="n">g</span> <span class="n">groupid</span>
</pre></div>
</div>
<p>list of fpga accelerators</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">command</span><span class="p">:</span> <span class="n">fpgainfo</span> <span class="n">port</span>

  <span class="c1">//****** PORT ******//</span>
  <span class="n">Object</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0x600D000000000000</span>
  <span class="n">PCIe</span> <span class="nl">s</span><span class="p">:</span><span class="nl">b</span><span class="p">:</span><span class="n">d</span><span class="p">.</span><span class="nl">f</span>                     <span class="p">:</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.3</span>
  <span class="n">Device</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0xAF00</span>
  <span class="n">Socket</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0xFF</span>
  <span class="n">Accelerator</span> <span class="nl">Id</span>                   <span class="p">:</span> <span class="mi">43425</span><span class="n">ee6</span><span class="mi">-92</span><span class="n">b2</span><span class="mi">-4742</span><span class="o">-</span><span class="n">b03a</span><span class="o">-</span><span class="n">bd8d4a533812</span>
  <span class="n">Accelerator</span> <span class="nl">GUID</span>                 <span class="p">:</span> <span class="mi">43425</span><span class="n">ee6</span><span class="mi">-92</span><span class="n">b2</span><span class="mi">-4742</span><span class="o">-</span><span class="n">b03a</span><span class="o">-</span><span class="n">bd8d4a533812</span>
  <span class="c1">//****** PORT ******//</span>
  <span class="n">Object</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0x400D000000000000</span>
  <span class="n">PCIe</span> <span class="nl">s</span><span class="p">:</span><span class="nl">b</span><span class="p">:</span><span class="n">d</span><span class="p">.</span><span class="nl">f</span>                     <span class="p">:</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.2</span>
  <span class="n">Device</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0xAF00</span>
  <span class="n">Socket</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0xFF</span>
  <span class="n">Accelerator</span> <span class="nl">Id</span>                   <span class="p">:</span> <span class="mi">8568</span><span class="n">AB4E</span><span class="mi">-6</span><span class="n">bA5</span><span class="mi">-4616</span><span class="o">-</span><span class="n">BB65</span><span class="mi">-2</span><span class="n">A578330A8EB</span>
  <span class="n">Accelerator</span> <span class="nl">GUID</span>                 <span class="p">:</span> <span class="mi">8568</span><span class="n">AB4E</span><span class="mi">-6</span><span class="n">bA5</span><span class="mi">-4616</span><span class="o">-</span><span class="n">BB65</span><span class="mi">-2</span><span class="n">A578330A8EB</span>
  <span class="c1">//****** PORT ******//</span>
  <span class="n">Object</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0x200D000000000000</span>
  <span class="n">PCIe</span> <span class="nl">s</span><span class="p">:</span><span class="nl">b</span><span class="p">:</span><span class="n">d</span><span class="p">.</span><span class="nl">f</span>                     <span class="p">:</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.1</span>
  <span class="n">Device</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0xAF00</span>
  <span class="n">Socket</span> <span class="nl">Id</span>                        <span class="p">:</span> <span class="mh">0xFF</span>
  <span class="n">Accelerator</span> <span class="nl">Id</span>                   <span class="p">:</span> <span class="mf">56e203</span><span class="n">e9</span><span class="mi">-864</span><span class="n">f</span><span class="mi">-49</span><span class="n">a7</span><span class="o">-</span><span class="n">b94b</span><span class="mi">-12284</span><span class="n">c31e02b</span>
  <span class="n">Accelerator</span> <span class="nl">GUID</span>                 <span class="p">:</span> <span class="mf">56e203</span><span class="n">e9</span><span class="mi">-864</span><span class="n">f</span><span class="mi">-49</span><span class="n">a7</span><span class="o">-</span><span class="n">b94b</span><span class="mi">-12284</span><span class="n">c31e02b</span>
</pre></div>
</div>
<p>FPGA VF1/3b:00.1/Host Exerciser Loopback Accelerator GUID: 56E203E9-864F-49A7-B94B-12284C31E02B</p>
<p>FPGA VF2/3b:00.2/Host Exerciser Memory Accelerator GUID: 8568AB4E-6bA5-4616-BB65-2A578330A8EB</p>
<p>FPGA VF3/3b:00.3/Host Exerciser HSSI Accelerator GUID: 43425ee6-92b2-4742-b03a-bd8d4a533812</p>
<p>Unbind pcie-vfio dirver to FPGA virtual functions</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>   <span class="n">sudo</span> <span class="n">opaevfio</span>  <span class="o">-</span><span class="n">r</span> <span class="mo">0000</span><span class="o">:</span><span class="mi">3</span><span class="nl">b</span><span class="p">:</span><span class="mf">00.1</span>
</pre></div>
</div>
<p>Host Exerciser Loopback (HE-LBK) AFU can move data between host memory and FPGA.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>  <span class="n">host_exerciser</span> <span class="n">lpbk</span>
  
  <span class="p">[</span><span class="n">lpbk</span><span class="p">]</span> <span class="p">[</span><span class="n">info</span><span class="p">]</span> <span class="n">starting</span> <span class="n">test</span> <span class="n">run</span><span class="p">,</span> <span class="n">count</span> <span class="n">of</span> <span class="mi">1</span>
  <span class="n">Input</span> <span class="nl">Config</span><span class="p">:</span><span class="mi">0</span>
  <span class="n">Allocate</span> <span class="n">SRC</span> <span class="n">Buffer</span>
  <span class="n">Allocate</span> <span class="n">DST</span> <span class="n">Buffer</span>
  <span class="n">Allocate</span> <span class="n">DSM</span> <span class="n">Buffer</span>
  <span class="n">Start</span> <span class="n">Test</span>
  <span class="n">Test</span> <span class="n">Completed</span>
  <span class="n">Host</span> <span class="n">Exerciser</span> <span class="n">swtest</span> <span class="nl">msg</span><span class="p">:</span><span class="mi">0</span>
  <span class="n">Host</span> <span class="n">Exerciser</span> <span class="nl">numReads</span><span class="p">:</span><span class="mi">32</span>
  <span class="n">Host</span> <span class="n">Exerciser</span> <span class="nl">numWrites</span><span class="p">:</span><span class="mi">32</span>
  <span class="n">Host</span> <span class="n">Exerciser</span> <span class="nl">numPendReads</span><span class="p">:</span><span class="mi">0</span>
  <span class="n">Host</span> <span class="n">Exerciser</span> <span class="nl">numPendWrites</span><span class="p">:</span><span class="mi">0</span>
  <span class="p">[</span><span class="n">lpbk</span><span class="p">]</span> <span class="p">[</span><span class="n">info</span><span class="p">]</span> <span class="n">Test</span> <span class="n">lpbk</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span> <span class="n">PASS</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to successfully run hello_fpga, the user needs to configure
system hugepage to reserve 2M-hugepages.
For example, the command below reserves 20 2M-hugepages:</p>
<p>$ echo 20 | sudo tee /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages</p>
<p>For x86_64 architecture CPU, user can use following command to find out avaiable huge page sizes:</p>
<p>$ grep pse /proc/cpuinfo | uniq
flags : … pse …</p>
<p>If this commands returns a non-empty string, 2MB pages are supported:</p>
<p>$ grep pse /proc/cpuinfo | uniq
flags : … pdpe1gb …</p>
<p>If this commands returns a non-empty string, 1GB pages are supported:</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default configuration for many Linux distribution currently sets a relatively low limit for pinned memory allocations per process (RLIMIT_MEMLOCK, often set to a default of 64kiB).
To run an OPAE application which attempts to share more memory than specified by this limit between software and an accelerator, you can either:</p>
<blockquote>
<div><ul class="simple">
<li><p>Run the application as root, or</p></li>
<li><p>Increase the limit for locked memory via ulimit:</p></li>
</ul>
<p>$ ulimit -l unlimited</p>
</div></blockquote>
<p>See the Installation Guide for how to permanently adjust the memlock limit.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../install_guide/installation_guide.html" class="btn btn-neutral float-right" title="OPAE Installation Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../../index.html" class="btn btn-neutral float-left" title="Open Programmable Acceleration Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>